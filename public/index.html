<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion-Aware AI Companion</title>
    <link rel="stylesheet" href="/css/styles.css">
    
    <!-- face-api.js from CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
    <!-- Background gradient animation -->
    <div class="gradient-bg"></div>
    
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2"/>
                    <circle cx="14" cy="16" r="2" fill="currentColor"/>
                    <circle cx="26" cy="16" r="2" fill="currentColor"/>
                    <path d="M12 24 Q20 28 28 24" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
            </div>
            <h1>Emotion Companion</h1>
            <p class="subtitle">Your empathetic AI friend</p>
        </header>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Left Panel: Camera & Emotion Detection -->
            <div class="camera-panel">
                <div class="panel-header">
                    <h2>Face Detection</h2>
                    <div class="status-indicator" id="cameraStatus">
                        <span class="status-dot"></span>
                        <span class="status-text">Inactive</span>
                    </div>
                </div>
                
                <!-- Video Container -->
                <div class="video-container" id="videoContainer">
                    <video id="videoElement" autoplay muted playsinline></video>
                    <canvas id="overlay"></canvas>
                    
                    <!-- Placeholder when camera is off -->
                    <div class="video-placeholder" id="videoPlaceholder">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                        <p>Camera Off</p>
                    </div>
                </div>

                <!-- Camera Controls -->
                <div class="camera-controls">
                    <button id="startCameraBtn" class="btn btn-primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polygon points="10 8 16 12 10 16 10 8" fill="currentColor"/>
                        </svg>
                        Start Camera
                    </button>
                    <button id="stopCameraBtn" class="btn btn-secondary" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <rect x="9" y="9" width="6" height="6" fill="currentColor"/>
                        </svg>
                        Stop Camera
                    </button>
                </div>

                <!-- Current Emotion Display -->
                <div class="emotion-display" id="emotionDisplay">
                    <div class="emotion-label">Detected Emotion</div>
                    <div class="emotion-value" id="currentEmotion">‚Äî</div>
                    <div class="emotion-confidence">
                        <span>Confidence: </span>
                        <span id="emotionConfidence">0%</span>
                    </div>
                </div>

                <!-- Emotion History Chart -->
                <div class="emotion-chart" id="emotionChart">
                    <div class="chart-title">Recent Emotions</div>
                    <div class="chart-bars" id="chartBars">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>

            <!-- Right Panel: Chat Interface -->
            <div class="chat-panel">
                <div class="panel-header">
                    <h2>Conversation</h2>
                    <button id="clearChatBtn" class="btn-icon" title="Clear chat">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </button>
                </div>

                <!-- Chat Messages Area -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome Message -->
                    <div class="message ai-message fade-in">
                        <div class="message-avatar">
                            <svg width="32" height="32" viewBox="0 0 40 40" fill="none">
                                <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2"/>
                                <circle cx="14" cy="16" r="2" fill="currentColor"/>
                                <circle cx="26" cy="16" r="2" fill="currentColor"/>
                                <path d="M12 24 Q20 28 28 24" stroke="currentColor" stroke-width="2" fill="none"/>
                            </svg>
                        </div>
                        <div class="message-content">
                            <div class="message-text">
                                Hello! I'm your emotion-aware AI companion. I can detect your facial expressions and understand the emotions in your words. Feel free to share how you're feeling today. üíô
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-container">
                    <!-- Voice Input Button (Optional) -->
                    <button id="voiceBtn" class="btn-icon voice-btn" title="Voice input">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    </button>

                    <!-- Text Input -->
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            placeholder="Type how you're feeling..."
                            rows="1"
                            maxlength="500"
                        ></textarea>
                    </div>

                    <!-- Send Button -->
                    <button id="sendBtn" class="btn-icon send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2" fill="currentColor"/>
                        </svg>
                    </button>
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        </div>

        <!-- Bottom: Emotion Summary -->
        <div class="summary-panel" id="summaryPanel">
            <h3>Today's Emotional Summary</h3>
            <div class="summary-grid" id="summaryGrid">
                <div class="summary-item">
                    <div class="summary-emotion">üòä Happy</div>
                    <div class="summary-count">0 times</div>
                </div>
                <div class="summary-item">
                    <div class="summary-emotion">üò¢ Sad</div>
                    <div class="summary-count">0 times</div>
                </div>
                <div class="summary-item">
                    <div class="summary-emotion">üòê Neutral</div>
                    <div class="summary-count">0 times</div>
                </div>
                <div class="summary-item">
                    <div class="summary-emotion">üò† Angry</div>
                    <div class="summary-count">0 times</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Loading face detection models...</p>
    </div>

    <!-- JavaScript Files -->
    <script src="/js/camera.js"></script>
    <script src="/js/emotion.js"></script>
    <script src="/js/speech.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>